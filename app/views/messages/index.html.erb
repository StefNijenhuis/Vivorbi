<% content_for :title, t('messages.search.title') %>
<% if @search_error.present? %>
  <div class="row">
    <div class="large-12 small-12 columns">
      <div class="error">
        <%=@search_error%>
      </div>
    </div>
  </div>
<% else %>
  <div class="row">
    <div class="small-12 large-12 columns">
      <div class="search_result_menu">
        <div class="row">
          <div class="small-12 large-6 columns">
            <% if !@keyword.empty? %>
              <%=@messages.count + @comments.count%> <%=t('search.results.keyword', :count => @messages.count + @comments.count)%> "<%=@keyword%>"
            <% else %>
              <%=@messages.count%> <%=t 'search.results.postal'%> <%=@location['street']%>, <%=@location['postcode']%> <%=@location['town']%>
            <% end %>
          </div>
          <% if @postal_code.empty? %>
            <div class="show-for-medium-up large-4 columns">
          <% else %>
            <div class="show-for-medium-up large-2 columns">
          <% end %>
            <%= t 'search.category' %>
          </div>
          <% unless @postal_code.empty? %>
            <div class="show-for-medium-up large-2 columns">
              <%=t 'search.distance' %>
            </div>
          <% end %>
          <div class="show-for-medium-up large-2 columns">
            <%=t 'search.date' %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% if (@messages == nil || @messages.empty?) && (@comments == nil || @comments.empty?) %>
  <% unless @search_error.present? %>
    <div class="row">
      <div class="large-12 small-12 columns">
        <div class=" large-12 columns no_result">
          <div class="large-12 small-12 columns">
            <%=t 'search.no_results' %>
          </div>
          <div class="large-3 small-12 columns pull-9">
            <%=link_to t('helpers.submit.message.create'), :new_message, class:"submit_button"%>
          </div>
        </div>
      </div>
    </div>
  <% end %>
<%else%>
  <% @messages.each do |m| %>
    <div class="row">
      <div class="small-12 large-12 columns">
        <div class="search_result">
          <div class="row">
            <div class="small-12 large-12 columns">
              <div class="small-12 large-6 columns">
                <h3><%= link_to m.title, m %></h3>
              </div>
              <% if @postal_code.empty? %>
                <div class="small-6 large-4 columns">
              <% else %>
                <div class="small-4 large-2 columns">
              <% end %>
                  <div class="distance">
                    <%=m.category.title%>
                  </div>
                </div>
              <% unless @postal_code.empty? %>
                <div class="small-4 large-2 columns">
                  <div class="distance">
                    <%=m.distance.round(1)%> km
                  </div>
                </div>
              <% end %>
              <div class="small-4 large-2 columns">
                <div class="time">
                  <%=l m.created_at, format: :short_date%>
                </div>
              </div>
            </div>
          </div>
          <div class="small-12 large-6 columns search_body">
            <p><%= m.body %></p>
          </div>
          <div class="small-12 large-3 columns">
            <%= link_to t('messages.show.title'), m, class:"result_button"%>
          </div>
        </div>
      </div>
    </div>
  <% end %>
  <% unless @comments == nil || @comments.empty? %>
    <% @comments.each do |c| %>
      <div class="row">
        <div class="small-12 large-12 columns">
          <div class="search_result">
            <div class="row">
              <div class="small-12 large-12 columns">
                <div class="small-12 large-6 columns">
                  <h3><%= link_to c.message.title, c.message %></h3>
                </div>
                <% if @postal_code.empty? %>
                  <div class="small-6 large-4 columns">
                <% else %>
                  <div class="small-4 large-2 columns">
                <% end %>
                    <div class="distance">
                      <%=c.message.category.title%>
                    </div>
                  </div>
                <% unless @postal_code.empty? %>
                  <div class="small-4 large-2 columns">
                    <div class="distance">
                      <%=c.message.distance.round(1)%> km
                    </div>
                  </div>
                <% end %>
                <div class="small-4 large-2 columns">
                  <div class="time">
                    <%=l c.message.created_at, format: :short_date%>
                  </div>
                </div>
              </div>
            </div>
            <div class="small-12 large-6 columns search_body">
              <p><%= c.message.body %></p>
            </div>
            <div class="small-12 large-3 columns">
              <%= link_to t('messages.show.title'), c.message, class:"result_button"%>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
<% end %>